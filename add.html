<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Add RX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --bg:#f5f5f7;
      --card:#ffffff;
      --ink:#111827;
      --sub:#6b7280;
      --blue:#0071e3;
      --green:#22c55e;
      --line:rgba(0,0,0,.08);
      --shadow:0 18px 45px rgba(0,0,0,.10);
      --r:26px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",system-ui,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--ink);
    }
    .wrap{padding:26px 6vw 28px;}
    .panel{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .topbar{
      padding:14px 16px;
      display:flex;
      align-items:center;
      gap:12px;
      border-bottom:1px solid var(--line);
      background:linear-gradient(180deg,#fff, #fafafa);
    }
    .backBtn{
      display:flex;
      align-items:center;
      justify-content:center;
      width:44px;height:44px;
      border-radius:16px;
      border:1px solid var(--line);
      background:#111827;
      box-shadow:0 10px 26px rgba(0,0,0,.10);
      cursor:pointer;
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .backBtn:hover{transform:translateY(-1px);box-shadow:0 14px 32px rgba(0,0,0,.14)}
    .backBtn:active{transform:scale(.98)}
    .backBtn img{width:22px;height:22px;object-fit:contain}

    .title{
      font-size:1.2rem;
      font-weight:800;
      margin:0;
    }
    .sub{margin:2px 0 0;color:var(--sub);font-size:.95rem}

    .content{padding:16px;}
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media(max-width:900px){ .grid{grid-template-columns:1fr;} }

    .field{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    label{font-size:.85rem;color:#475569;font-weight:700}
    input, select, textarea{
      border:1px solid var(--line);
      border-radius:16px;
      height:46px;
      padding:0 12px;
      font-size:.96rem;
      outline:none;
      background:#fff;
    }
    textarea{
      height:110px;
      padding:10px 12px;
      resize:vertical;
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      padding: 14px 16px 18px;
      border-top:1px solid var(--line);
    }
    .btn{
      border:none;
      height:46px;
      padding:0 16px;
      border-radius:16px;
      cursor:pointer;
      font-weight:750;
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .btn:active{transform:scale(.99)}
    .btn.primary{background:var(--blue);color:#fff;box-shadow:0 14px 30px rgba(0,113,227,.22)}
    .btn.ghost{background:#111827;color:#fff}
    .note{
      color:var(--sub);
      font-size:.92rem;
      margin-left:auto;
      align-self:center;
    }
    .status{font-weight:800}
    .ok{color:#047857}
    .err{color:#b91c1c}
  </style>
</head>

<body>
  <main class="wrap">
    <section class="panel">
      <div class="topbar">
        <button class="backBtn" id="back" title="Back to Dispense">
          <img src="sigler-500-white.png" alt="Back icon" />
        </button>
        <div>
          <h2 class="title">Add Prescription</h2>
          <p class="sub">Writes a new RX row into Google Sheet.</p>
        </div>
      </div>

      <div class="content">
        <div class="grid">
          <div class="field">
            <label>Resident</label>
            <input id="resident" placeholder="Resident name" />
          </div>

          <div class="field">
            <label>Medication</label>
            <input id="med" placeholder="Drug name" />
          </div>

          <div class="field">
            <label>Timing</label>
            <select id="timing">
              <option value="AM">AM</option>
              <option value="NOON">NOON</option>
              <option value="PM">PM</option>
              <option value="HS">HS</option>
              <option value="NIGHT">NIGHT</option>
              <option value="BID AM/PM">BID AM/PM</option>
              <option value="TID AM/NOON/PM">TID AM/NOON/PM</option>
              <option value="QID AM/NOON/PM/HS">QID AM/NOON/PM/HS</option>
              <option value="PRN">PRN</option>
            </select>
          </div>

          <div class="field">
            <label>Dose / Instructions</label>
            <textarea id="instr" placeholder="Example: 1 tablet by mouth with food"></textarea>
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="btn primary" id="addBtn">Add RX</button>
        <button class="btn ghost" id="clearBtn">Clear</button>
        <div class="note"><span id="status" class="status"></span></div>
      </div>
    </section>
  </main>

  <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxHqruOM0OncDT-ZGT7HqhkjklKU0rpg2-BpBiqk4iDsGD5EfxFcM-fd1-n2Y2vcUU/exec"; // <-- same deployed GAS Web App URL
    const SPREADSHEET_ID = "17FXMcaJ2un_rhKKlYZbJR6yd2BDgISIM2k0z6iC9_O4";
    const SHEET_NAME = "Dispense";

    const statusEl = document.getElementById("status");

    document.getElementById("back").addEventListener("click", ()=> {
      window.location.href = "index.html";
    });

    function setStatus(msg, cls=""){
      statusEl.className = "status " + cls;
      statusEl.textContent = msg || "";
    }

    async function api(action, payload){
      if (!WEB_APP_URL){
        throw new Error("WEB_APP_URL is empty. Paste your deployed Google Apps Script Web App URL.");
      }
      const res = await fetch(WEB_APP_URL, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ action, spreadsheetId: SPREADSHEET_ID, sheetName: SHEET_NAME, ...payload })
      });
      const data = await res.json();
      if (!data.ok) throw new Error(data.error || "Unknown error");
      return data;
    }

    function val(id){ return document.getElementById(id).value.trim(); }

    document.getElementById("clearBtn").addEventListener("click", ()=>{
      ["resident","med","instr"].forEach(id => document.getElementById(id).value = "");
      document.getElementById("timing").value = "AM";
      setStatus("Cleared", "");
    });

    document.getElementById("addBtn").addEventListener("click", async ()=>{
      try{
        const resident = val("resident");
        const med = val("med");
        const timing = val("timing");
        const instr = val("instr");

        if (!resident || !med || !timing){
          setStatus("Fill Resident + Medication + Timing", "err");
          return;
        }

        setStatus("Adding…");
        await api("add_rx", { resident, med, instr, timing });

        setStatus("Added ✅", "ok");

        // optional: clear fields after add
        document.getElementById("med").value = "";
        document.getElementById("instr").value = "";
      }catch(e){
        setStatus("Error: " + e.message, "err");
      }
    });
  </script>
</body>
</html>
